<template>
  <div ref='fadingCircle' style="justify-content:center;align-items:center" :style='wrapStyle' v-if="show">
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(0deg);opacity: 0.1'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(30deg);opacity: 0.2'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(60deg);opacity: 0.4'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(90deg);opacity: 0.6'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(120deg);opacity: 0.7'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(150deg);opacity: 0.8'>
      <div class='point' :style="pointStyle"></div>
    </div>
    <div :style="blockStyle" style='transform-origin: bottom;transform: rotate(180deg);'>
      <div class='point' :style="pointStyle"></div>
    </div>
  </div>
</template>

<script>
  const animation = weex.requireModule('animation')
  const pointSize = 8
  export default {
    data () {
      return {
      }
    },
    props:{
      show: {
        type: Boolean,
        default: true
      },
      size: {
        type: [Boolean, String],
        default: '45px'
      },
      spinnerColor: {
        type: String,
        default: '#004684'
      }
    },
    computed: {
      pointStyle () {
        return {
          width: pointSize,
          height: pointSize,
          top: 0,
          left: 0,
          backgroundColor: this.spinnerColor,
          borderRadius: pointSize/2
        }
      },
      blockStyle () {
        let size = parseFloat(this.size)
        return {
          width: pointSize,
          height: size,
          position: 'absolute',
          top: 0,
          left: size/2 - 5
        }
      },
      wrapStyle () {
        let {size} = this
        return {
          width: size,
          height: size
        }
      }
    },
    mounted() {
      this.$nextTick(() => {
        this.infinitRotate()
      })
    },
    methods: {
      infinitRotate (angle = 3600) {
        animation.transition(this.$refs.fadingCircle, {
            styles:{
                transform:`rotate(${angle}deg)`
            },
            duration: angle * 2.3,
            timingFunction: 'linear'
        },()=>{
            if (this.show) {
                angle *= 100
                this.infinitRotate(angle)
            }
        })
      }
    }
  }
</script>

<style lang="stylus">
  .point
    right: 0px
    top: 0px
</style>
