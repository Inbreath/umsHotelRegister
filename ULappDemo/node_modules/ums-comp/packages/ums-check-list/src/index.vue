<template>
    <div class="content">
        <div class="wrapper">
            <div class="cell" v-for="(option,index) in options">
                <div class="select-item" @click="clickBtn(index)" :class="[alignRight? 'dir-reverse':'']">
                    <div class="circle-button" ref="btn" :class="[btnCheckable(option)? 'button-disable' : '']">
                            <text class="icon-gou"
                                  :class="[option.check ? 'icon-check' : 'icon-uncheck',
                                           option.disabled ?'icon-check-disable':'icon-check-enable',
                                           btnCheckable(option)? 'icon-hidden':'']"
                                  :style="{fontFamily:'iconfont'}"
                                  ref="icon">&#xe63c;</text>
                    </div>
                    <div class="item">
                        <text style="font-size:48px;line-height:122px">{{option.label}}</text>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    var animation = weex.requireModule('animation');
    export default{

        name:"ums-check-list",

        data(){
            return {
                title:'',
                current:0,
                flagArr:[],
                val:this.value
            };
        },
        props:{
            value:{
                type:String,
                default:''
            },
            options:{
                type: Array,
                default:function(){
                    return [
                        {
                            label:'选项1',
                            value:'选中第一个',
                            disabled:false,
                            check:false,
                        },
                        {
                            label:'选项2',
                            value:'选中第二个',
                            disabled:false,
                            check:false,
                        },
                        {
                            label:'选项3',
                            value:'选中第三个',
                            disabled:false,
                            check:false
                        },
                        {
                            label:'选项4',
                            value:'选中第四个',
                            disabled:false,
                            check:false
                        }
                    ]
                }
            },
            'align-right':{
                type: Boolean,
                default: false
            },
            max:{
                type:Number,
                default: -1
            }
        },
        watch:{
            flagArr(newVal){
                var str='',tmp = [];
                this.current = 0;
                for(let i = 0; i < newVal.length;i++){
                    if(newVal[i]){
                        this.current++;
                        tmp.push(this.options[i].value);
                    }
                }
                this.$emit('checklistListener',tmp);
            }
        },
        mounted(){
            let btns = this.$refs.btn;
            for(let i=0; i< btns.length;i++){
                this.flagArr.push(this.options[i].check);
            }
        },
        methods:{
            clickBtn(index){
                if(!this.options[index].disabled){
                    if(this.current == this.max){
                        if(this.flagArr[index]){
                            this.current--;
                            console.log(this.current);
                        }else{
                            return;
                        }
                    }
                    this.toggle(index);
                    this.$set(this.flagArr,index,!this.flagArr[index]);
                    this.options[index].check = !this.options[index].check;
                }
            },
            toggle(index){
                let li = this.$refs.icon
                if(this.flagArr[index]){
                    animation.transition(li[index],{
                        duration:300,
                        delay:0,
                        timingFunction:'linear',
                        styles:{
                            opacity:0
                        }
                    })
                }else{
                    animation.transition(li[index],{
                        duration:300,
                        delay:0,
                        timingFunction:'linear',
                        styles:{
                            opacity:1
                        }
                    })
                }
            },
            btnCheckable(option){
                if(this.max != -1){
                    if(this.current < this.max){
                        if(!option.check && option.disabled){
                            return true
                        }
                        return false;
                    }else{
                        if(!option.check){
                            return true;
                        }
                    }
                }else{
                    if(!option.check && option.disabled){
                        return true
                    }
                    return false;
                }
            }
        },
        beforeCreate(){
            var dom = weex.requireModule('dom');
            dom.addRule('fontFace',{
                "fontFamily":'iconfont',
                "src":"url('../../../static/font/UmsIconFont.ttf')"
            })
        }
    }
</script>

<style lang="stylus" rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .wrapper
        padding-left: 40px
        border-top-width: 1px
        border-bottom-width: 1px
        border-color: $check-list-border
    .cell
        border-bottom-color: $check-list-border
        border-bottom-width: 1px
    .select-item
        flex-direction: row
        height: 122px
        align-items: center
        padding-right: 54px
    .circle-button
        width: 54px
        height: 54px
        border-radius: 200px
        border-width: 1px
        border-color: $check-list-border
        line-height: 122px
        justify-content: center
        align-items: center
        margin-left: 40px
    .icon-gou
        text-align: center
        font-size: 62px
    .icon-check
        opacity: 1
    .icon-uncheck
        opacity: 0
    .icon-check-enable
        color: $check-list-enable
    .icon-check-disable
        color: $check-list-disable
    .item
        font-size: 48px
        margin-left: 32px
        line-height: 122px
    .dir-reverse
        flex-direction: row-reverse
        justify-content: space-between
    .button-disable
        background-color: $check-list-disable
    .icon-hidden
        display: none
</style>