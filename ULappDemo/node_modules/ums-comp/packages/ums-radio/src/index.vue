<template>
    <div class="body">
        <div class="wrap" :class="clslist" :style="wrapStyl" ref="wdiv">
            <div class="inner" :style="innerStyl" ref="idiv"></div>
        </div>
    </div>
</template>

<script>
    var animation = weex.requireModule('animation');
    export default{
        name: "ums-radio",
        data(){
          return{
              toggleFlag:true,
              state:this.checked
          }
        },
        props:{
            //radio大小
            size:{
                type:[Number,String],
                default:'middle'
            },
            //radio背景色
            backgroundColor:{
                type:String,
                default:"#26a2ff"
            },
            //禁用状态
            disable: {
                type:[String,Boolean],
                default:false
            },
            //选中状态
            checked:{
                type:[String,Boolean],
                default:false
            },
            //使用动画
            animation:{
                type:Boolean,
                default:false
            }
        },
        watch:{
            checked(val){
                this.toggle();
            }
        },
        computed:{
            clslist(){
                let li = [],size;
                size = parseInt(this.size);
                if(isNaN(size)){
                    li.push('radio-'+this.size);
                }
                return li
            },
            wrapStyl(){
                let unit,radius,styles = {},size;
                size = parseInt(this.size);
                if (!isNaN(size)) {
                    unit = size + "px";
                    styles['width'] = unit;
                    styles['height'] = unit;
                    styles['borderRadius'] = size / 2 + 'px';
                }
                if (!this.disable && this.state) {        //disable: false  checked: true
                    styles['backgroundColor'] = this.backgroundColor;
                }else if(this.disable && this.state || this.disable && !this.state){     //disable: true  checked: true || disable: true checked: false
                    styles['backgroundColor'] = "#D9D9D9";
                }else if(!this.disable && !this.state){
                    styles['backgroundColor'] = "transparent"
                }
                styles['borderColor'] = "#D9D9D9";
                return styles;
            },
            innerStyl(){
                let unit,radius,styles={},size;
                size = parseInt(this.size);
                if (!isNaN(size)) {
                    unit = size/2 +'px';
                    styles['width'] = unit;
                    styles['height'] = unit
                }else if(this.size === 'middle'){
                    unit = '27px';
                    styles['width'] = unit;
                    styles['height'] = unit;
                }
                if( this.disable && !this.state){
                    styles['backgroundColor'] = "#D9D9D9";
                }else if(this.state){
                    styles['backgroundColor'] = "#ffffff";
                    styles['borderColor'] = "#D9D9D9";
                }
                styles['borderRadius'] = parseInt(unit)/2+"px";
                return styles;
            }
        },
        methods:{
            toggle(){
                if(this.disable && this.toggleFlag){
                    return;
                }
                if(this.animation){
                    this.toggleFlag = !this.toggleFlag
                    let tmp = this.toggleColor();
                    animation.transition(this.$refs.wdiv,{
                        styles:tmp,
                        duration: 100,
                    },()=>{
                        this.state = !this.state;
                        this.toggleFlag = !this.toggleFlag
                        this.$emit('onRadioClick',this.state);
                    });
                }else{
                    this.state = !this.state;
                    this.$emit('onRadioClick',this.state);
                }
            },
            toggleColor(){
                if(!this.state){
                    return {
                        backgroundColor:this.backgroundColor
                    }
                }else{
                    return {
                        backgroundColor:"#ffffff"
                    }
                }
            }
        }
    }
</script>

<style lang='stylus' rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .wrap
        border-width 1px
        justify-content center
        align-items center
    .radio-middle
        width: 54px
        height: 54px
        border-radius: 27px
    .inner
        background-color: $color-white
</style>