<template>
    <div>
        <text style="font-family:checkbutton;"
            :style="[inner,borderRadius]" ref="icon"
            class="inner"
            @click='toggle'
            :class="[state?'button-check':'button-uncheck']"
            >&#xe63c;</text>
    </div>
</template>

<script>
    var dom = weex.requireModule('dom');
    var animation = weex.requireModule('animation');
    export default{
        data(){
            return {
                state: ''
            }
        },
        props:{
            size:{
                type:[String,Number],
                default:'48px'
            },
            color:{
                type:String,
                default:'#26a2ff'
            },
            disable:{
                type:Boolean,
                default:false
            },
            checked:{   // 初始化状态
                type:Boolean,
                default:true
            },
        },
        beforeCreate () {
            dom.addRule('fontFace',{
                "fontFamily":'checkbutton',
                "src":"url('../../../static/font/UmsIconFont.ttf')"
            })
        },
        created(){
            this.state = this.checked //状态初始化
        },
        computed:{
            calSize(){
                return parseFloat(this.size);
            },
            inner(){
                let styles={},size;
                size = this.calSize;
                styles['width'] = this.calSize + 'px'
                styles['height'] = this.calSize + 'px'
                styles['fontSize'] = this.calSize + 'px';
                styles['lineHeight'] = this.calSize + 'px';
                if(this.disable){
                    if(this.state){
                        styles['color'] = '#D9D9D9'
                    }else{
                        styles['color'] = '#D9D9D9'
                        styles['backgroundColor'] = "#D9D9D9"
                    }
                }else{
                    styles['color'] = this.color;
                    if(!this.state){
                        styles['color'] = "#ffffff"
                    }
                }
                return styles;
            },
            borderRadius(){
                let styles={},size
                size = this.calSize;
                styles['borderRadius'] = size/2+'px';
                return styles;
            }
        },
        watch:{
            checked(){
               this.toggle();
            }
        },
        methods:{
            toggle(){
                let icon = this.$refs.icon
                if(this.disable){
                    return;
                }
                if(this.state){
                    animation.transition(icon,{
                        duration:100,
                        delay:0,
                        timingFunction:'linear',
                        styles:{
                            color:"#ffffff"
                        }
                    },()=>{
                        this.state = !this.state;
                        this.$emit('onCheckButtonClick',this.state);
                    })
                }else{
                    animation.transition(icon,{
                        duration:100,
                        delay:0,
                        timingFunction:'linear',
                        styles:{
                            color:this.color
                        }
                    },()=>{
                        this.state = !this.state;
                        this.$emit('onCheckButtonClick',this.state);
                    })
                }

            }
        }
    }
</script>

<style lang='stylus' rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .inner
        text-align center
    .button-check
        border-width 0px
        border-color #d9d9dd
    .button-uncheck
        border-width 1px
        border-color #d9d9dd
</style>