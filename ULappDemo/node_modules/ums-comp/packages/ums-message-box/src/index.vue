<template>
    <div style="position: fixed;top: 0px;left: 0px;right: 0px; bottom: 0px" append="tree" @click.stop>
        <div class="toast position" :style="toastStyle" v-if="!isNotLoading">
            <image :src="typeSelect" :style="iconStyle" class=""></image>
            <text class="tag">{{loadingMessage}}</text>
        </div>
        <div class="confirm position" :style="toastStyle" v-else>
            <div><text class="alignCenter tip" style="">{{title}}</text></div>
            <div class="alignCenter promptInput" v-if="type === 'promptInput'">
                <input type="text" class="pinput" :placeholder="message" v-model="inputValue"/>
                <text class="error-text">{{errorText}}</text>
            </div>
            <div class="alignCenter" v-else-if="type === 'promptRadio' && radioOpts !== null">
                <div v-for="(opt, index) in radioOpts" class="radioOpts" @click="radioSelect(index)" :key="index">
                    <radio size="42" :checked="opt.flag" style="margin-right: 20px"></radio>
                    <text>{{opt.label}}</text>
                </div>
            </div>
            <div v-else><text class="alignCenter" style="color: #999;">{{message}}</text></div>
            <div class="alignCenter btnBlock">
                <text class="btn cancel alignCenter" @click="handlerAction('cancel')" v-if="type !== 'alert'">取消</text>
                <text class="btn confirmBtn alignCenter" @click="handlerAction('confirm')">确认{{loadingTime|unitMinute}}</text>
            </div>
        </div>
        <div class="mask"></div>
    </div>
</template>

<script>
   import radio from '../../ums-radio/index.js'
   import umsApi from 'ums-api'
   import logo from './logo.gif'
   import print from './print.gif'
   export default{
        data(){
            return {
                radioOpts: null,
                iconSrc:{
                    loading: logo,
                    print: print
                },
                styles:{
                    loading: {
                        width:'384px',
                        borderRadius:'15px',
                    },
                    confirm: {
                        width:'582px',
                        borderRadius:'15px',
                    },
                    alert: {
                        width:'582px',
                        borderRadius:'15px',
                    },
                    promptInput: {
                        width:'582px',
                        borderRadius:'15px',
                    },
                    promptRadio: {
                        width:'582px',
                        borderRadius:'15px',
                    },
                    print:{
                        width:'384px',
                        borderRadius:'15px',
                        paddingBottom: '92px'
                    }
                },
                icon:{
                    loading: {
                        marginTop: '96px',
                        marginBottom: '96px',
                        width: '272px',
                        height: '128px'
                    },
                    print: {
                        width: '230px',
                        height: '180px',
                        marginBottom: '62px',
                        marginTop: '62px'
                    }
                },
                loadingTime: 5,
                loadingTimeFlag: true,
                type: 'loading',
                message: '',
                callback: null,
                title: '',
                isNotLoading:'',
                inputValue:'',
                radioValue:'',
                errorText:''
            }
        },
        components: {
            radio
        },
        filters: {
            unitMinute(val){
                if(val!=0){
                    return `(${val}s)`;
                }else {
                    return ''
                }
            }
        },
        computed:{
            typeSelect(){
                return this.iconSrc[this.type];
            },
            toastStyle(){
                let tmp;
                tmp = Object.assign({},this.styles[this.type]);
                return this.calPositionCenter(tmp);
            },
            iconStyle(){
                return this.icon[this.type]
            },
            loadingMessage () {
                return this.message + '' + (this.loadingTime !== 0 && this.loadingTimeFlag ? `(${this.loadingTime}s)` : '')
            }
        },
        methods:{
            calPositionCenter(dist){
                let tmp,height,width;
                width = parseInt(dist.width);
                dist.marginLeft = -(width/2) + "px";
                return dist
            },
            handlerAction (action) {
                if (action === 'confirm' && this.type == 'promptInput' && !this.valite(this.inputValue)) {
                    return
                }
                this.callback(action);
            },
            valite (inputVal) {
                if (inputVal === null || inputVal === '') {
                    this.errorText = '输入的数据不合法!'
                    setTimeout(() => {
                        this.errorText = ''
                    },1000)
                    return false
                }
                return true
            },
            radioSelect (index) {
                console.log(index + ' ' + this.radioOpts)
                this.radioOpts.forEach((cur, i) => {
                    index === i ? (cur.flag = true) : (cur.flag = false)
                })
                this.radioValue = this.radioOpts[index].value
            }
        },
        mounted(){
            let time;
            time = setInterval(()=>{
                if(this.loadingTime >0){
                    this.loadingTime--;
                }else{
                    clearInterval(time);
                }
            },1000)
        }
    }
</script>

<style lang='stylus' rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .mask
        width: $maxWidth
        height: $maxHeight
        justify-content center
        align-items center
        background-color #222222
        opacity 0.4
    .position
        position: fixed
        top: 667px
        left: 375px
    .toast
        background-color $color-white
        justify-content center
        align-items center
        transform translate(0, -300px)
    .tag
        font-size: 38px
        font-family:'微软雅黑'
        color: #686868
        text-align center
        margin-bottom: 5px
    .confirm
        justify-content space-between
        align-items stretch
        background-color $color-white
        transform translateY(-300px)
    .alignCenter
        text-align center
    .btn
        flex:1
        line-height: 96px
    .confirmBtn
        background-color $theme-color
        color: #fff
        border-right-width 1px
        border-bottom-width 1px
        border-color $theme-color
        &:active
            background-color #0078c9
    .btnBlock
        border-top-width: 1px
        border-color: $theme-color
        flex-direction row
        height 96px
        margin-top: 54px
    .cancel
        color: $theme-color
    .tip
        font-size: 38px
        font-weight: bold
        margin-top: 58px
        margin-bottom: 50px
    .promptInput
        padding-left 45px
        padding-right 45px
    .pinput
        border-width 1px
        border-color #dedede
        border-radius 10px
        height 64px
        padding-left 15px
    .error-text
        font-size 28px
        color: red
        line-height 32px
        margin-top 5px
    .radioOpts
        height: 96px
        align-items center
        flex-direction row
        justify-content flex-start
        margin-left 56px
</style>