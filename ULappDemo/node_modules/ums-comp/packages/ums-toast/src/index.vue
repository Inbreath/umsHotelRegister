<template>
    <div class="wrap" @click.stop>
        <div class="mask"></div>
        <div class="toast" :class="[position,type==''?'toast-txt':'toast-icon']"  ref="wrap">
            <div class="icon" v-if="iconCode !== ''" ref="icon">
                <text class="icon-txt">{{iconCode}}</text>
            </div>
            <div class="message">
                <text class="txt">{{message}}</text>
            </div>
        </div>
    </div>
</template>

<script>
    let he = require('he');
    const animation = weex.requireModule('animation');
    export default{
        name:'ums-toast',
        data(){
            return {
                type: null,
                message: null,
                position: 'center',
                duration: null,
                callback: null
            }
        },
        beforeCreate(){
            var dom = weex.requireModule('dom');
            dom.addRule('fontFace',{
                fontFamily:'toast',
                src:"url('../../../static/font/UmsIconFont.ttf')"
            })
        },
        computed:{
            iconCode(){
                let code;
                switch (this.type){
                    case 'waiting':
                        code = he.decode('&#xe63f;');
                        break;
                    case 'success':
                        code = he.decode('&#xe60b;');
                        break;
                    default:
                        code = '';
                        break;
                }
                return code;
            }
        },
        methods:{
            animate(){
                let limit = this.duration;
                if(this.type == 'waiting'){
                    if (this.duration != null && this.duration !== 0) {
                        animation.transition(this.$refs.icon,{
                            duration: limit,
                            timingFunction:'linear',
                            styles:{
                                transform: `rotate(${0.1*limit}deg)`
                            }
                        },()=>{
                            this.close();
                        });
                    }else {
                        this.toggle(10000)
                    }
                }else{
                    if (this.duration != null && this.duration !== 0) {
                        setTimeout(()=>{
                            this.close();
                        },this.duration)
                    }
                }
            },
            toggle (limit) {
                if (!this.$refs.icon) {
                    return
                }
                animation.transition(this.$refs.icon, {
                    duration: limit,
                    timingFunction:'linear',
                    styles:{
                        transform: `rotate(${0.1*limit}deg)`
                    }
                }, ()=>{
                    this.toggle(limit* 10)
                })
            }
        }
    }
</script>

<style lang='stylus' rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .wrap
        align-items: center
        position: fixed
        top: 0px
        left: 0px
        width: 750px
    .toast
        background-color $toast-background-color
        border-radius 10px
        opacity 0.7
        padding: 10px
        width: 300px
        align-items: center
        position: fixed
        top: 450px
        margin-left 375px
        transform translateX(-50%);
    .top
        top: 100px
    .center
        top: 400px
    .bottom
        top: 1000px
    .txt
        color: $color-white
        font-size: 48px
        text-align: center
        width: 300px
    .icon
        height: 80px
        transform: rotate(0deg)
        margin-top 40px
        margin-bottom 20px
    .icon-txt
        font-family: toast;
        font-size:78px;
        color: $color-white
    .message
        margin-top: 20px
        margin-bottom: 20px
    .mask
        width: 750px
        position: fixed
        top: 0px
        left: 0px
        right: 0px
        bottom: 0px
        background-color: $color-black
        opacity: 0.4
        justify-content: center
        align-items: center
</style>