<template>
    <div class="wrap" :style="[wrapStyle]" @click="toggle" ref="wDiv">
        <div class="button" :style="[btnStyle]" ref="btn"></div>
    </div>
</template>

<script>
    const animation = weex.requireModule('animation')
    export default{
        name:"ums-switch",
        data(){
            return {
                switchFlag:this.state,
                animated:true
            }
        },
        props:{
            //背景颜色
           color:{
                type:String,
                default:"#26a2ff"
           },
            //整个按钮高度，按键的宽高按照0.94进行计算
           switchHeight:{
               type:[String,Number],
               default: "80px"
           },
           switchWidth: {
               type:[String,Number],
               default: 140
           },
            //按键是否开启
           state:{
              type:Boolean,
              default:false
           },
            //按键时候被禁用
           disable:{
               type: Boolean,
               default:false
           }
        },
        computed:{
            wrapStyle(){
                let {switchHeight, switchWidth, color} = this
                let styles = {}
                styles['height'] = switchHeight
                styles['width'] = switchWidth
                styles['borderRadius'] = parseFloat(switchHeight)/2+'px'
                if(this.disable && this.state){
                    styles['align-items'] = "flex-end"
                    styles['backgroundColor'] = color
                    styles['opacity'] = 0.5
                }
                if(this.state){
                    styles['backgroundColor'] = color
                }
                return styles
            },
            btnStyle(){
                let styles = {}
                let {switchHeight, switchWidth, color} = this
                let size = parseFloat(switchHeight)* 0.94+"px"
                styles['width'] = size
                styles['height'] = size
                styles['borderRadius'] = parseFloat(size)/2+'px'
                if(this.state&& !this.disable){
                    styles['transform']="translateX("+(parseFloat(switchWidth)-parseFloat(size))+"px)"
                }
                return styles
            },
        },
        methods:{
            toggle(){
                if(this.disable || !this.animated){
                    return
                }
                this.animated = false //解决反复动画事件执行时错误的flag，确保只能执行一次
                let btn = this.$refs.btn,len,bColor
                len = this.move()
                bColor = this.changeColor()
                animation.transition(btn,{
                    styles:len,
                    duration :200
                },()=>{
                    this.switchFlag = !this.switchFlag
                    this.animated = true
                    this.$emit('swithToggle',this.switchFlag)
                })
                animation.transition(this.$refs.wDiv,{
                    styles:bColor,
                    duration: 200
                })
            },
            move(){
                if(!this.switchFlag){
                    return {
                        transform:"translateX("+(parseFloat(this.switchWidth)-parseFloat(this.switchHeight))+"px)",
                    }
                }else{
                    return {
                        transform: "translateX(-5px)",
                    }
                }
            },
            changeColor(){
                if(this.switchFlag){
                    return {
                        backgroundColor:"#ffffff"
                    }
                }else{
                    return {
                        backgroundColor:this.color
                    }
                }
            }
        }
    }
</script>

<style lang='stylus' rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .wrap
        width 140px
        height: 80px
        justify-content center
        align-items flex-start
        border-radius: 40px
        border-width: 1px
        border-color: $switch-border-color
        background-color: $color-white
    .button
        width 75px
        height: 75px
        border-radius 40px
        margin-left 5px
        background-color  $color-white
        border-color: $switch-button-border-color
        border-width: 1px
        transform: translateX(-5px)
</style>