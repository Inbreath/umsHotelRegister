<template>
    <div class="content">
        <div @click="add" @touchstart="test" @touchend="testover" :class="['icon-lnicon34','btn-'+type,'btn',isLeftActive?'':'btn-disable']">
            <text :style="{fontFamily:'iconfont'}" :class="['btn-txt','btn-txt-'+type]">&#xe626;</text>
        </div>
        <div :class="['input-num-'+type,'input-num',isInputActive?'':'btn-disable']">
            <text :value="val+''" class="number"></text>
        </div>
        <div @click="reduce" :class="['icon-jian','btn-'+type,'btn',isRightActive?'':'btn-disable']">
            <text :style="{fontFamily:'iconfont'}" :class="['btn-txt','btn-txt-'+type]">&#xe67f;</text>
        </div>
    </div>
</template>

<script>
    export default{
        name:"ums-inputnumber",
        data(){
            return {
                isRightActive:true,
                isLeftActive:true,
                isInputActive:true,
                val:this.value,
                timer:null
            }
        },
        props:{
            type:{
                type:String,
                default:'small'
            },
            value:{
                type:Number,
                default:0
            },
            step:{
                type:Number,
                default:1
            },
            max:{
                type:Number,
                default:Infinity
            },
            min:{
                type:Number,
                default: -Infinity
            },
            disabled:{
                type:Boolean,
                default: false
            }
        },
        methods:{
            touchStart(){
                timer = setInterval(this.add,100);
            },
            touchOver(){
                clearInterval(timer);
            },
            add(){
                if(this.val < this.max && this.val+this.step <= this.max){
                    this.val += this.step;
                    this.$emit('input',this.val);
                }
            },
            reduce(){
                if(this.val > this.min){
                    this.val -= this.step;
                    this.$emit('input',this.val);
                }
            },
            checkRange(){
                if(this.val == this.max){
                    this.isRightActive = true;
                    this.isLeftActive = false;
                }else if(this.val == this.min){
                    this.isRightActive = false;
                    this.isLeftActive = true;
                }else{
                    this.isRightActive = true;
                    this.isLeftActive = true;
                }
            }
        },
        watch:{
            val(){
                this.checkRange();
            }
        },
        beforeCreate(){
            var dom = weex.requireModule('dom');
            dom.addRule('fontFace',{
                "fontFamily":'iconfont',
                "src":"url('../../../static/font/UmsIconFont.ttf')"
            });
        },
        created () {
            this.checkRange();
            if(this.disabled){
                this.add = function(){};
                this.reduce = function(){};
                this.isRightActive = false;
                this.isLeftActive = false;
                this.isInputActive = false;
            }
        }
    }
</script>

<style lang="stylus" rel="stylesheet/stylus" scoped>
    @import '../../../src/styles/var'
    .content
        flex-direction: row
    .btn
        width: 86px
        border-width: 1px
        border-color: $border-color
    .btn:active
        background-color: $input-number-disable
    .btn-txt
        font-size: 42px
        font-weight: bolder
        text-align: center
        color: $input-number-text
    .icon-lnicon34
        border-top-left-radius: 12px
        border-bottom-left-radius: 12px
    .icon-jian
        border-top-right-radius: 12px
        border-bottom-right-radius: 12px
    .btn-disable
        background-color: $input-number-disable
    .btn-small
        height: 86px
    .btn-txt-small
        line-height: 86px
    .btn-large
        height: 126px
    .btn-txt-large
        line-height: 126px
    .input-num
        width: 268px
        border-color $border-color
        border-width: 1px
        border-left-width: 0px
        border-right-width: 0px
        justify-content: center
        align-items: center
    .input-num-small
        line-height: 86px
        height: 86px
    .input-num-large
        line-height: 126px
        height: 126px
    .number
        font-size: 55px
        font-weight: normal
</style>
