<template>
    <div>
        <ums-overlayer
            :opacity="overLayerOpacity"
            :hasAnimation='true'
            :show="overLayer"
            v-if="show"
            @overlayerClick="maskClose"
            @overlayerAppearFinish="displayMask(show)"
        ></ums-overlayer>
        <div class="content"
             v-if="show"
             :style="maskStyles"
              ref="umsMask">
            <div :style="contentStyle">
                <slot></slot>
            </div>
        </div>
    </div>
</template>

<script>
    const animation = weex.requireModule('animation')
    const umsOverlayer = require('../../ums-overlayer/index.js')

    module.exports = {
        data(){
            return {
                overLayer: false
            }
        },
        props:{
            // 控制组件遮罩显示
            show: {
                type: Boolean,
                default: false
            },
            // 遮罩内容的宽度
            width: {
                type: [Number, String],
                default: 702
            },
            // 遮罩内容的高度
            height: {
                type: [Number, String],
                default: 800
            },
            // 遮罩内容的圆角弧度
            borderRadius: {
                type: [Number, String],
                default: 0
            },
            // 遮罩内容的背景色
            backgroundColor: {
                type: String,
                default: '#FFFFFF'
            },
            // 遮罩内容的透明度
            opacity: {
                type: [Number, String],
                default: 1
            },
            // 遮罩的透明度
            overLayerOpacity: {
                type: [Number, String],
                default: 0.6
            },
            // 出现是否有过渡动画
            hasAnimation: {
                type:Boolean,
                default: true
            },
            // 是否有遮罩
            hasOverLayer: {
                type: Boolean,
                default: true    
            },
            // 动画的过渡时间
            duration: {
                type: [Number, String],
                default: 300
            }
        },
        components: {
            umsOverlayer
        },
        watch: {
            show (newVal) {
                setTimeout(() => {
                    this.overLayer = newVal
                }, 50)
            }
        },
        methods: {
            displayMask(flag, duration = this.duration) {
                animation.transition(this.$refs.umsMask, {
                    styles: {
                        opacity: flag ? this.opacity: 0
                    },
                    delay: 50,
                    duration: this.hasAnimation ? duration : 0,
                    timingFunction: 'ease'
                }, () => {
                })
            },
            maskClose () {
                this.$emit('overLayerClose')
            }
        },
        computed: {
            maskStyles() {
                const {width, height, borderRadius, backgroundColor} = this
                let left = (750 - parseFloat(width)) / 2
                const {deviceHeight, deviceWidth, platform} = weex.config.env
                const _deviceHeight = deviceHeight || 1334
                return {
                    left,
                    backgroundColor,
                    width: width,
                    height: height,
                    borderRadius: borderRadius,
                    top: (_deviceHeight - parseFloat(height)) / 2
                }
            },
            contentStyle() {
                return {
                    width: this.width,
                    height: this.height,
                    borderRadius: this.borderRadius
                }    
            }
        }
    }
</script>

<style rel="stylesheet/stylus" lang="stylus" scoped>
    .content
        position fixed
        opacity 0
</style>